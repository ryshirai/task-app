# 認証・ロール管理および日報機能 実装計画書

## 1. 概要
現状の「誰でも全操作が可能」な状態から、セキュリティと権限管理を導入し、業務の振り返りを行うための「日報機能」を追加します。

## 2. データベース変更点 (Migration)

### users テーブル (既存の members を拡張)
- `username`: ユニークなログインID
- `password_hash`: ハッシュ化されたパスワード
- `role`: 権限 (`admin`, `user`)
- `name`, `avatar_url`: (既存項目)

### daily_reports テーブル (新規)
- `id`: 主キー
- `user_id`: ユーザーID (FK)
- `report_date`: 対象日 (YYYY-MM-DD)
- `content`: 日報本文 (Markdown形式)
- `created_at`: 作成日時

## 3. 認証・認可 (Auth & Roles)

- **方式**: JWT (JSON Web Token) によるステートレス認証。
- **権限設定**:
  - `admin`: 全ユーザーのタスク編集、ユーザー追加・削除、全日報の閲覧。
  - `user`: 自身のタスク編集、自身の日報作成・編集、他者のタイムライン閲覧。

## 4. 日報機能の仕様

- **自動連携**: 当日のタスク一覧を日報入力画面に「参考」として表示。
- **作成フロー**:
  1. ユーザーがログイン。
  2. タイムライン画面に「今日の日報を書く」ボタンを表示。
  3. モーダルで内容を入力（タスク内容から自動生成するテンプレート機能付き）。
  4. 保存後、チームメンバーが閲覧可能に。

## 5. 開発フェーズ

### フェーズ 1: バックエンド基盤 (Auth)
1.  `argon2` (パスワードハッシュ) と `jsonwebtoken` の導入。
2.  `members` テーブルを `users` へ移行するマイグレーション。
3.  ログイン API (`/api/auth/login`) の実装。
4.  認証用ミドルウェアの実装。

### フェーズ 2: 日報 API とロール制御
1.  `daily_reports` テーブルの作成。
2.  CRUD API (`GET /api/reports`, `POST /api/reports`)。
3.  APIレベルでの `role` チェックの実装。

### フェーズ 3: フロントエンド実装
1.  ログインページ (`/login`) の作成。
2.  JWTの永続化 (LocalStorage/Cookie) と HTTP Header への付与。
3.  日報入力フォームの作成。
4.  権限に応じたUI要素の表示・非表示制御（例：管理者のみ設定ボタン表示）。

---

## 6. 次のステップ

この計画でよろしければ、まずは **バックエンドの依存ライブラリ追加と、データベースのマイグレーション** から着手します。
特にユーザー管理への移行により、既存のシードデータやフロントエンドの「メンバー」という呼び方も「ユーザー」に統一していく方針です。
